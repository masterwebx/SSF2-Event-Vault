name: Discord Notify - compile/online Changes

on:
  push:
    branches:
      - main  # Change if your default branch is different
    paths:
      - 'compile/online/**'

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          # Safely escape the commit message for JSON (handles newlines, quotes, etc.)
          MESSAGE_JSON=$(printf '%s' "${{ github.event.head_commit.message }}" | jq -Rs .)

          jq -n \
            --arg title "New changes in compile/online folder! ðŸš€" \
            --arg author "${{ github.event.head_commit.author.name }}" \
            --arg branch "${{ github.ref_name }}" \
            --argjson message "$MESSAGE_JSON" \
            --arg compare_url "${{ github.event.compare }}" \
            --arg commit_url "https://github.com/${{ github.repository }}/commit/${{ github.sha }}" \
            --arg timestamp "${{ github.event.head_commit.timestamp }}" \
            '{
              embeds: [{
                title: $title,
                fields: [
                  {
                    name: "Commit Summary",
                    value: ($message // "No commit message"),
                    inline: false
                  },
                  {
                    name: "Details",
                    value: "**Author:** \($author)\n**Branch:** \($branch)\n\n[View all changes](\($compare_url))\n[View commit](\($commit_url))",
                    inline: false
                  }
                ],
                color: 3447003,  # Blue
                timestamp: $timestamp
              }]
            }' | curl -H "Content-Type: application/json" -d @- "$DISCORD_WEBHOOK"
